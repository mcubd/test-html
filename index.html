<!DOCTYPE html>
<html>
  <head>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Socket.IO dfe </title>
    <style>
     h5{
      display: inline-block;
      font-size: 7px;
     }
     li{
      font-size: 12px;
     }
    
    </style>
  </head>
  <body>
    <button class="his" id="his"  onclick="loadHis()">History</button>
    <ul id="messages"></ul>
    <h1 id="h1"></h1>





<script>
var messages = document.getElementById('messages');


// ---------------get

function get(){
var xhttp = new XMLHttpRequest();
xhttp.open("GET", 'https://nodebd.vercel.app/', true);
// xhttp.setRequestHeader('n', valu)
xhttp.onload = function () {
    const obj = JSON.parse(this.responseText);
    if(this.responseText=='[]'){document.getElementById("h1").innerHTML ='nai'}else{
      var node = document.createElement('li')
      var h5 = document.createElement('h5')
      h5.textContent=obj[0].num
      node.textContent =obj[0].date+'-----'+ obj[0].name+'-----'+obj[0].ipad 
      node.appendChild(h5);
        messages.appendChild(node);

        // setTimeout(() => {his5()}, 1000);
    }}
xhttp.send();
};get()


function loadHis(){
  document.getElementById('his').disabled =true
  var last =document.getElementById('messages')
 if(last.firstChild.lastChild.innerHTML==1){alert('no more')}else{


  var xhttp = new XMLHttpRequest();
xhttp.open("GET", 'https://nodebd.vercel.app/his', true);

xhttp.setRequestHeader('n', last.firstChild.lastChild.innerHTML-2)
xhttp.onload = function () {
    const obj = JSON.parse(this.responseText);
    if(this.responseText=='[]'){document.getElementById("h1").innerHTML ='nai'}else{
      var node = document.createElement('li')
      var h5 = document.createElement('h5')
      h5.textContent=obj[0].num
    node.textContent =obj[0].date+'-----'+ obj[0].name+'-----'+obj[0].ipad 
    node.appendChild(h5);

    last.insertBefore(node, last.firstChild)
  document.getElementById('his').disabled =false

    }}
    xhttp.send();

}}


function neww(){
  var las =document.getElementById('messages')
  var h11 =document.getElementById('h1')
if(h11.innerHTML='nai'){

  var xhttp = new XMLHttpRequest();
xhttp.open("GET", 'https://nodebd.vercel.app/his', true);

xhttp.onload = function () {
    const obj = JSON.parse(this.responseText);
    if(this.responseText=='[]'){}else{
      var node = document.createElement('li')
      var h5 = document.createElement('h5')
      h5.textContent=obj[0].num
    node.textContent =obj[0].date+'-----'+ obj[0].name+'-----'+obj[0].ipad 
    node.appendChild(h5);
    las.append(node);
    }}

    xhttp.send();
}else if(document.getElementById('messages').lastChild){

  var mesg=document.getElementById('messages')
  var xhttp = new XMLHttpRequest();
  xhttp.open("GET", 'https://nodebd.vercel.app/his', true);
  xhttp.setRequestHeader('n', mesg.lastChild.lastChild.innerHTML)

  xhttp.onload = function () {
    const obj = JSON.parse(this.responseText);
    if(this.responseText=='[]'){}else{
      var node = document.createElement('li')
      var h5 = document.createElement('h5')
      h5.textContent=obj[0].num
    node.textContent =obj[0].date+'-----'+ obj[0].name+'-----'+obj[0].ipad 
    node.appendChild(h5);
    las.append(node);
    }}

    xhttp.send();

}else if(h11.innerHTML=''){}else{alert('what!!!')}

}

setInterval(() => {neww()}, 20000);


// var addMessage = function (msg, d, con) {
//     var node = document.createElement('li')
//     // node.style.backgroundColor = "red"
//     node.textContent = msg;
//         messages.appendChild(node);
//       // if (con !== 'noo') { lkk() }
//     addtime(d)
// };


// function loadHis(){
//      var dae = document.getElementById("messages").children[1].innerText
//     socket.emit('loadhis', dae)

// }

// socket.on('his', (data, ttt) => {
//     addhis(data, ttt);
// })


// var addhis = function (msg, o) {
//     {
//       var onn=document.getElementById("messages")

//       var node = document.createElement('li')
//       node.textContent = msg;
//       var no = document.createElement('li')
      
//         // messages.appendChild(no);
//     }

//     if (msg !== "No more data") { no.textContent = o; }
//     // if (message === "No more data") { node.classList.add('last') }

//     var one = onn.firstElementChild;
//     onn.insertBefore(node, one)
//     onn.insertBefore(no, one)
// }




</script>




<link href="1.css" rel="stylesheet">

  </body>
</html>




